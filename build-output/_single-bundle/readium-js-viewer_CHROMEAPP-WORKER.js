var requirejs,require,define;!function(e){function t(e,t){return b.call(e,t)}function i(e,t){var i,n,r,a,o,s,l,c,f,u,d,_=t&&t.split("/"),h=p.map,v=h&&h["*"]||{};if(e&&"."===e.charAt(0))if(t){for(e=e.split("/"),o=e.length-1,p.nodeIdCompat&&g.test(e[o])&&(e[o]=e[o].replace(g,"")),e=_.slice(0,_.length-1).concat(e),f=0;f<e.length;f+=1)if(d=e[f],"."===d)e.splice(f,1),f-=1;else if(".."===d){if(1===f&&(".."===e[2]||".."===e[0]))break;f>0&&(e.splice(f-1,2),f-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((_||v)&&h){for(i=e.split("/"),f=i.length;f>0;f-=1){if(n=i.slice(0,f).join("/"),_)for(u=_.length;u>0;u-=1)if(r=h[_.slice(0,u).join("/")],r&&(r=r[n])){a=r,s=f;break}if(a)break;!l&&v&&v[n]&&(l=v[n],c=f)}!a&&l&&(a=l,s=c),a&&(i.splice(0,s,a),e=i.join("/"))}return e}function n(t,i){return function(){var n=w.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),f.apply(e,n.concat([t,i]))}}function r(e){return function(t){return i(t,e)}}function a(e){return function(t){_[e]=t}}function o(i){if(t(h,i)){var n=h[i];delete h[i],v[i]=!0,c.apply(e,n)}if(!t(_,i)&&!t(v,i))throw new Error("No "+i);return _[i]}function s(e){var t,i=e?e.indexOf("!"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function l(e){return function(){return p&&p.config&&p.config[e]||{}}}var c,f,u,d,_={},h={},p={},v={},b=Object.prototype.hasOwnProperty,w=[].slice,g=/\.js$/;u=function(e,t){var n,a=s(e),l=a[0];return e=a[1],l&&(l=i(l,t),n=o(l)),l?e=n&&n.normalize?n.normalize(e,r(t)):i(e,t):(e=i(e,t),a=s(e),l=a[0],e=a[1],l&&(n=o(l))),{f:l?l+"!"+e:e,n:e,pr:l,p:n}},d={require:function(e){return n(e)},exports:function(e){var t=_[e];return"undefined"!=typeof t?t:_[e]={}},module:function(e){return{id:e,uri:"",exports:_[e],config:l(e)}}},c=function(i,r,s,l){var c,f,p,b,w,g,y=[],m=typeof s;if(l=l||i,"undefined"===m||"function"===m){for(r=!r.length&&s.length?["require","exports","module"]:r,w=0;w<r.length;w+=1)if(b=u(r[w],l),f=b.f,"require"===f)y[w]=d.require(i);else if("exports"===f)y[w]=d.exports(i),g=!0;else if("module"===f)c=y[w]=d.module(i);else if(t(_,f)||t(h,f)||t(v,f))y[w]=o(f);else{if(!b.p)throw new Error(i+" missing "+f);b.p.load(b.n,n(l,!0),a(f),{}),y[w]=_[f]}p=s?s.apply(_[i],y):void 0,i&&(c&&c.exports!==e&&c.exports!==_[i]?_[i]=c.exports:p===e&&g||(_[i]=p))}else i&&(_[i]=s)},requirejs=require=f=function(t,i,n,r,a){if("string"==typeof t)return d[t]?d[t](i):o(u(t,i).f);if(!t.splice){if(p=t,p.deps&&f(p.deps,p.callback),!i)return;i.splice?(t=i,i=n,n=null):t=e}return i=i||function(){},"function"==typeof n&&(n=r,r=a),r?c(e,t,i,n):setTimeout(function(){c(e,t,i,n)},4),f},f.config=function(e){return f(e)},requirejs._defined=_,define=function(e,i,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");i.splice||(n=i,i=[]),t(_,e)||t(h,e)||(h[e]=[e,i,n])},define.amd={jQuery:!0}}(),define("readium-js-viewer_CHROMEAPP-WORKER",function(){});var currentURL=self.location?self.location.protocol+"//"+self.location.hostname+(self.location.port?":"+self.location.port:"")+(self.location.pathname?self.location.pathname:""):"";console.log(currentURL),console.log(self.location.origin),require.config({waitSeconds:0,config:{"readium_js_viewer/ModuleConfig":{mathJaxUrl:self.location.origin+"/scripts/mathjax/MathJax.js",annotationCSSUrl:self.location.origin+"/css/annotations.css",jsLibRoot:"/scripts/zip/",useSimpleLoader:!0,epubLibraryPath:void 0,imagePathPrefix:void 0,canHandleUrl:!1,canHandleDirectory:!0,workerUrl:"/scripts/readium-js-viewer_CHROMEAPP-WORKER.js",epubReadingSystemUrl:self.location.origin+"/scripts/epubReadingSystem.js"}}}),define("readium_js_viewer_RJS-CONFIG",function(){}),define("readium_js_viewer/workers/Messages",[],function(){return{IMPORT_ZIP:0,OVERWRITE_CONTINUE:1,FIND_PACKAGE_RESPONSE:2,PARSE_PACKAGE_RESPONSE:3,DELETE_EPUB:4,IMPORT_DIR:5,IMPORT_URL:6,MIGRATE:7,OVERWRITE_SIDE_BY_SIDE:8,CONTINUE_IMPORT_ZIP:9,SUCCESS:100,PROGRESS:101,ERROR:102,OVERWRITE:103,FIND_PACKAGE:104,PARSE_PACKAGE:105,PROGRESS_EXTRACTING:200,PROGRESS_WRITING:201,PROGRESS_DELETING:202,PROGRESS_MIGRATING:203,ERROR_STORAGE:300,ERROR_EPUB:301,ERROR_AJAX:302}}),define("StorageManager",["readium_js_viewer/workers/Messages"],function(e){var t,i=function(){var e=function(e){return Array.prototype.slice.call(e||[],0)},t=function(e,t,i,n,r){e.getFile(t,{create:!0},function(e){e.createWriter(function(a){a.onwriteend=function(){!a.error&&a.position<a.length?a.truncate(a.position):n&&n(e)},a.onerror=function(){console.error("failed: "+t),r(a.error)},i instanceof ArrayBuffer&&(i=new Uint8Array(i));var o=i instanceof Blob?i:new Blob([i]);a.write(o)},r)},r)},n=function(e,t,i,n){e.getDirectory(t,{create:!0},i,n)};return{mkdirs:function(e,t,i,r){var a;a=t instanceof Array?t:t.split("/");var o=function(e){a.length?n(e,a.shift(),o,r):i&&i(e)};o(e)},rmDir:function(e,t,i,n){e.getDirectory(t,{create:!0},function(e){e.removeRecursively(i,n)})},rmFile:function(e,t,i,n){e.getFile(t,{create:!0},function(e){e.remove(i,n)})},mkfile:function(e,n,r,a,o){"/"==n.charAt(0)&&(n=n.substring(1));var s=n.split("/");s.length>1?i.mkdirs(e,s.slice(0,s.length-1),function(e){t(e,s[s.length-1],r,a,o)},o):t(e,n,r,a,o)},ls:function(t,i,n){var r=t.createReader(),a=[],o=function(){r.readEntries(function(t){t.length?(a=a.concat(e(t)),o()):i(a)},n)};o()},readBlob:function(e,t,i){var n=new FileReader;n.onloadend=function(){i(n.result)},n["readAs"+t](e)},readFileEntry:function(e,t,n){e.file(function(e){i.readBlob(e,t,n)})},readFile:function(e,t,n,r,a){e.getFile(t,{create:!1},function(e){i.readFileEntry(e,n,r,a)},a)}}}(),n=function(t,i,n){return function(r){var a={original:r,path:i,error:r.name,op:t};n(e.ERROR_STORAGE,a),console.error(a)}},r=function(e,t,n,a){i.ls(e,function(e){var o=0,s=function(){++o==e.length&&n()};e.forEach(function(e){e.isFile?e.file(function(n){i.mkfile(t,e.name,n,s)}):i.mkdirs(t,e.name,function(t){r(e,t,s)},a)})},a)},a=function(e,i,n,a){var o=i.key;e.getDirectory(o,{create:!1},function(e){var i=function(){t.getDirectory(o,{create:!0},function(t){r(e,t,n,a)},a)};t.getDirectory(o,{create:!1},function(e){e.removeRecursively(i,a)},i)},a)},o=function(e,t,i,n,r,o){var s=self.location.hostname;requestFileSystem(self.TEMPORARY,5368709120,function(c){for(var f=c.root,u=[],d=0;d<i.rows.length;d++){var _=JSON.parse(i.rows.item(d).value);_.id&&u.push(_)}var h=0,p=function(e){++h==u.length?n():o(Math.round(h/u.length*100),e.title)};u.forEach(function(i){a(f,i,function(){var n="filesystem:chrome-extension://"+s+"/temporary/",a=i.cover_href?i.cover_href.substring(n.length):null,o={id:i.id,rootDir:i.key,rootUrl:l.getPathUrl(i.key),packagePath:i.package_doc_path.substring(i.key.length+1),title:i.title,author:i.author,coverHref:a?l.getPathUrl(a):null};e.push(o);var c=new Blob([JSON.stringify(e)]);l.saveFile("/epub_library.json",c,function(){t.transaction(function(e){e.executeSql("delete from records where id=? or id=?",[i.key,i.key+"_epubViewProperties"],p.bind(null,i),r)})},r)})})},r)},s=function(e,n,r){var a=openDatabase("records","1.0.0","records",65536);a&&a.transaction(function(s){s.executeSql("select id, value from records",[],function(s,l){if(l.rows.length){var c=function(t){var i=[];("string"==typeof t||t instanceof String)&&(i=JSON.parse(t)),o(i,a,l,e,n,r)};i.readFile(t,"/epub_library.json","Text",c,c)}else e()},n)})};self.requestFileSystem=self.requestFileSystem||self.webkitRequestFileSystem;var l={saveFile:function(e,r,a,o){i.mkfile(t,e,r,a,n("save",e,o))},deleteFile:function(e,r,a){var o=n("delete",e,a);"/"==e?i.ls(t,function(e){var t=e.length,i=function(){0==--t&&r()};e.forEach(function(e){e.isDirectory?e.removeRecursively(i,o):e.remove(i,o)})},a):i.rmDir(t,e,r,o)},getPathUrl:function(e){return"/"==e.charAt(0)&&(e=e.substring(1)),t.toURL()+e},initStorage:function(e,i){return t?void e():void requestFileSystem(self.PERSISTENT,5368709120,function(i){t=i.root,e()},n("init","/",i))},migrateLegacyBooks:function(e,t,i){var n=function(){var e=JSON.stringify(arguments),i="Unexpected error while migrating. "+e;console.error(i),t(i)};s(e,n,i)}};return l}),function(e){"use strict";function t(){this.crc=-1}function i(){}function n(e,t,i){if(0>t||0>i||t+i>e.size)throw new RangeError("offset:"+t+", length:"+i+", size:"+e.size);return e.slice?e.slice(t,t+i):e.webkitSlice?e.webkitSlice(t,t+i):e.mozSlice?e.mozSlice(t,t+i):e.msSlice?e.msSlice(t,t+i):void 0}function r(e,t){var i,n;return i=new ArrayBuffer(e),n=new Uint8Array(i),t&&n.set(t,0),{buffer:i,array:n,view:new DataView(i)}}function a(){}function o(e){function t(t,i){var a=new Blob([e],{type:N});n=new l(a),n.init(function(){r.size=n.size,t()},i)}function i(e,t,i,r){n.readUint8Array(e,t,i,r)}var n,r=this;r.size=0,r.init=t,r.readUint8Array=i}function s(t){function i(e){for(var i=t.length;"="==t.charAt(i-1);)i--;a=t.indexOf(",")+1,o.size=Math.floor(.75*(i-a)),e()}function n(i,n,o){var s,l=r(n),c=4*Math.floor(i/3),f=4*Math.ceil((i+n)/3),u=e.atob(t.substring(c+a,f+a)),d=i-3*Math.floor(c/4);for(s=d;d+n>s;s++)l.array[s-d]=u.charCodeAt(s);o(l.array)}var a,o=this;o.size=0,o.init=i,o.readUint8Array=n}function l(e){function t(t){r.size=e.size,t()}function i(t,i,r,a){var o=new FileReader;o.onload=function(e){r(new Uint8Array(e.target.result))},o.onerror=a;try{o.readAsArrayBuffer(n(e,t,i))}catch(s){a(s)}}var r=this;r.size=0,r.init=t,r.readUint8Array=i}function c(){}function f(e){function t(e){r=new Blob([],{type:N}),e()}function i(e,t){r=new Blob([r,D?e:e.buffer],{type:N}),t()}function n(t,i){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.onerror=i,n.readAsText(r,e)}var r,a=this;a.init=t,a.writeUint8Array=i,a.getData=n}function u(t){function i(e){o+="data:"+(t||"")+";base64,",e()}function n(t,i){var n,r=s.length,a=s;for(s="",n=0;n<3*Math.floor((r+t.length)/3)-r;n++)a+=String.fromCharCode(t[n]);for(;n<t.length;n++)s+=String.fromCharCode(t[n]);a.length>2?o+=e.btoa(a):s=a,i()}function r(t){t(o+e.btoa(s))}var a=this,o="",s="";a.init=i,a.writeUint8Array=n,a.getData=r}function d(e){function t(e){e()}function i(e,t){r.push(D?e:e.buffer),t()}function n(t){t(new Blob(r,{type:e}))}var r=[],a=this;a.init=t,a.writeUint8Array=i,a.getData=n}function _(e,t,i,n,r,a,o,s,l,c){function f(){e.removeEventListener("message",u,!1),s(h,p)}function u(t){var i=t.data,r=i.data,s=i.error;if(s)return s.toString=function(){return"Error: "+this.message},void l(s);if(i.sn===b)switch("number"==typeof i.codecTime&&(e.codecTime+=i.codecTime),"number"==typeof i.crcTime&&(e.crcTime+=i.crcTime),i.type){case"append":r?(h+=r.length,n.writeUint8Array(r,function(){d()},c)):d();break;case"flush":p=i.crc,r?(h+=r.length,n.writeUint8Array(r,function(){f()},c)):f();break;case"progress":o&&o(_+i.loaded,a);break;case"importScripts":case"newTask":case"echo":break;default:console.warn("zip.js:launchWorkerProcess: unknown message: ",i)}}function d(){_=v*j,a>_?i.readUint8Array(r+_,Math.min(j,a-_),function(i){o&&o(_,a);var n=0===_?t:{sn:b};n.type="append",n.data=i;try{e.postMessage(n,[i.buffer])}catch(r){e.postMessage(n)}v++},l):e.postMessage({sn:b,type:"flush"})}var _,h,p,v=0,b=t.sn;h=0,e.addEventListener("message",u,!1),d()}function h(e,i,n,r,a,o,s,l,c,f){function u(){var t;if(d=_*j,a>d)i.readUint8Array(r+d,Math.min(j,a-d),function(t){var i;try{i=e.append(t,function(e){s&&s(d+e,a)})}catch(r){return void c(r)}i?(h+=i.length,n.writeUint8Array(i,function(){_++,setTimeout(u,1)},f),v&&b.append(i)):(_++,setTimeout(u,1)),p&&b.append(t),s&&s(d,a)},c);else{try{t=e.flush()}catch(o){return void c(o)}t?(v&&b.append(t),h+=t.length,n.writeUint8Array(t,function(){l(h,b.get())},f)):l(h,b.get())}}var d,_=0,h=0,p="input"===o,v="output"===o,b=new t;u()}function p(t,i,n,r,a,o,s,l,c,f,u){var d=s?"output":"none";if(e.zip.useWebWorkers){var p={sn:i,codecClass:"Inflater",crcType:d};_(t,p,n,r,a,o,c,l,f,u)}else h(new e.zip.Inflater,n,r,a,o,d,c,l,f,u)}function v(t,i,n,r,a,o,s,l,c){var f="input";if(e.zip.useWebWorkers){var u={sn:i,options:{level:a},codecClass:"Deflater",crcType:f};_(t,u,n,r,0,n.size,s,o,l,c)}else h(new e.zip.Deflater,n,r,0,n.size,f,s,o,l,c)}function b(t,n,r,a,o,s,l,c,f,u,d){var p="input";if(e.zip.useWebWorkers&&l){var v={sn:n,codecClass:"NOOP",crcType:p};_(t,v,r,a,o,s,f,c,u,d)}else h(new i,r,a,o,s,p,f,c,u,d)}function w(e){var t,i,n="",r=["Ç","ü","é","â","ä","à","å","ç","ê","ë","è","ï","î","ì","Ä","Å","É","æ","Æ","ô","ö","ò","û","ù","ÿ","Ö","Ü","ø","£","Ø","×","ƒ","á","í","ó","ú","ñ","Ñ","ª","º","¿","®","¬","½","¼","¡","«","»","_","_","_","¦","¦","Á","Â","À","©","¦","¦","+","+","¢","¥","+","+","-","-","+","-","+","ã","Ã","+","+","-","-","¦","-","+","¤","ð","Ð","Ê","Ë","È","i","Í","Î","Ï","+","+","_","_","¦","Ì","_","Ó","ß","Ô","Ò","õ","Õ","µ","þ","Þ","Ú","Û","Ù","ý","Ý","¯","´","­","±","_","¾","¶","§","÷","¸","°","¨","·","¹","³","²","_"," "];for(t=0;t<e.length;t++)i=255&e.charCodeAt(t),n+=i>127?r[i-128]:String.fromCharCode(i);return n}function g(e){return decodeURIComponent(escape(e))}function y(e){var t,i="";for(t=0;t<e.length;t++)i+=String.fromCharCode(e[t]);return i}function m(e){var t=(4294901760&e)>>16,i=65535&e;try{return new Date(1980+((65024&t)>>9),((480&t)>>5)-1,31&t,(63488&i)>>11,(2016&i)>>5,2*(31&i),0)}catch(n){}}function x(e,t,i,n,r){return e.version=t.view.getUint16(i,!0),e.bitFlag=t.view.getUint16(i+2,!0),e.compressionMethod=t.view.getUint16(i+4,!0),e.lastModDateRaw=t.view.getUint32(i+6,!0),e.lastModDate=m(e.lastModDateRaw),1===(1&e.bitFlag)?void r(T):((n||8!=(8&e.bitFlag))&&(e.crc32=t.view.getUint32(i+10,!0),e.compressedSize=t.view.getUint32(i+14,!0),e.uncompressedSize=t.view.getUint32(i+18,!0)),4294967295===e.compressedSize||4294967295===e.uncompressedSize?void r(z):(e.filenameLength=t.view.getUint16(i+22,!0),void(e.extraFieldLength=t.view.getUint16(i+24,!0))))}function k(t,i,n){function a(){}function o(e){function i(i,a){t.readUint8Array(t.size-i,i,function(t){for(var i=t.length-r;i>=0;i--)if(80===t[i]&&75===t[i+1]&&5===t[i+2]&&6===t[i+3])return void e(new DataView(t.buffer,i,r));a()},function(){n(M)})}var r=22;if(t.size<r)return void n(P);var a=65536,o=r+a;i(r,function(){i(Math.min(o,t.size),function(){n(P)})})}var s=0;a.prototype.getData=function(e,i,a,o){function l(e){var t=r(4);return t.view.setUint32(0,e),d.crc32==t.view.getUint32(0)}function c(t,r){o&&!l(r)?n(F):e.getData(function(e){i(e)})}function f(e){n(e||L)}function u(e){n(e||C)}var d=this;t.readUint8Array(d.offset,30,function(i){var l,_=r(i.length,i);return 1347093252!=_.view.getUint32(0)?void n(P):(x(d,_,4,!1,n),l=d.offset+30+d.filenameLength+d.extraFieldLength,void e.init(function(){0===d.compressionMethod?b(d._worker,s++,t,e,l,d.compressedSize,o,c,a,f,u):p(d._worker,s++,t,e,l,d.compressedSize,o,c,a,f,u)},u))},f)};var l={getEntries:function(e){var i=this._worker;o(function(o){var s,l;return s=o.getUint32(16,!0),l=o.getUint16(8,!0),0>s||s>=t.size?void n(P):void t.readUint8Array(s,t.size-s,function(t){var o,s,c,f,u=0,d=[],_=r(t.length,t);for(o=0;l>o;o++){if(s=new a,s._worker=i,1347092738!=_.view.getUint32(u))return void n(P);x(s,_,u+6,!0,n),s.commentLength=_.view.getUint16(u+32,!0),s.directory=16==(16&_.view.getUint8(u+38)),s.offset=_.view.getUint32(u+42,!0),c=y(_.array.subarray(u+46,u+46+s.filenameLength)),s.filename=2048===(2048&s.bitFlag)?g(c):w(c),s.directory||"/"!=s.filename.charAt(s.filename.length-1)||(s.directory=!0),f=y(_.array.subarray(u+46+s.filenameLength+s.extraFieldLength,u+46+s.filenameLength+s.extraFieldLength+s.commentLength)),s.comment=2048===(2048&s.bitFlag)?g(f):w(f),d.push(s),u+=46+s.filenameLength+s.extraFieldLength+s.commentLength}e(d)},function(){n(M)})})},close:function(e){this._worker&&(this._worker.terminate(),this._worker=null),e&&e()},_worker:null};e.zip.useWebWorkers?A("inflater",function(e){l._worker=e,i(l)},function(e){n(e)}):i(l)}function E(e){return unescape(encodeURIComponent(e))}function S(e){var t,i=[];for(t=0;t<e.length;t++)i.push(e.charCodeAt(t));return i}function R(t,i,n,a){function o(e){n(e||O)}function s(e){n(e||L)}var l={},c=[],f=0,u=0,d={add:function(e,i,d,_,h){function p(i){var n;x=h.lastModDate||new Date,y=r(26),l[e]={headerArray:y.array,directory:h.directory,filename:m,offset:f,comment:S(E(h.comment||""))},y.view.setUint32(0,335546376),h.version&&y.view.setUint8(0,h.version),a||0===h.level||h.directory||y.view.setUint16(4,2048),y.view.setUint16(6,(x.getHours()<<6|x.getMinutes())<<5|x.getSeconds()/2,!0),y.view.setUint16(8,(x.getFullYear()-1980<<4|x.getMonth()+1)<<5|x.getDate(),!0),y.view.setUint16(22,m.length,!0),n=r(30+m.length),n.view.setUint32(0,1347093252),n.array.set(y.array,4),n.array.set(m,30),f+=n.array.length,t.writeUint8Array(n.array,i,o)}function w(e,n){var a=r(16);f+=e||0,a.view.setUint32(0,1347094280),"undefined"!=typeof n&&(y.view.setUint32(10,n,!0),a.view.setUint32(4,n,!0)),i&&(a.view.setUint32(8,e,!0),y.view.setUint32(14,e,!0),a.view.setUint32(12,i.size,!0),y.view.setUint32(18,i.size,!0)),t.writeUint8Array(a.array,function(){f+=16,d()},o)}function g(){return h=h||{},e=e.trim(),h.directory&&"/"!=e.charAt(e.length-1)&&(e+="/"),l.hasOwnProperty(e)?void n(B):(m=S(E(e)),c.push(e),void p(function(){i?a||0===h.level?b(k,u++,i,t,0,i.size,!0,w,_,s,o):v(k,u++,i,t,h.level,w,_,s,o):w()},o))}var y,m,x,k=this._worker;i?i.init(g,s):g()},close:function(e){this._worker&&(this._worker.terminate(),this._worker=null);var i,n,a,s=0,u=0;for(n=0;n<c.length;n++)a=l[c[n]],s+=46+a.filename.length+a.comment.length;for(i=r(s+22),n=0;n<c.length;n++)a=l[c[n]],i.view.setUint32(u,1347092738),i.view.setUint16(u+4,5120),i.array.set(a.headerArray,u+6),i.view.setUint16(u+32,a.comment.length,!0),a.directory&&i.view.setUint8(u+38,16),i.view.setUint32(u+42,a.offset,!0),i.array.set(a.filename,u+46),i.array.set(a.comment,u+46+a.filename.length),u+=46+a.filename.length+a.comment.length;i.view.setUint32(u,1347093766),i.view.setUint16(u+8,c.length,!0),i.view.setUint16(u+10,c.length,!0),i.view.setUint32(u+12,s,!0),i.view.setUint32(u+16,f,!0),t.writeUint8Array(i.array,function(){t.getData(e)},o)},_worker:null};e.zip.useWebWorkers?A("deflater",function(e){d._worker=e,i(d)},function(e){n(e)}):i(d)}function U(e){var t=document.createElement("a");return e.map(function(e){return t.href=e,t.href})}function A(t,i,n){function r(e){var t=e.data;return t.error?(s.terminate(),void n(t.error)):void("importScripts"===t.type&&(s.removeEventListener("message",r),s.removeEventListener("error",a),i(s)))}function a(e){s.terminate(),n(e)}if(null!==e.zip.workerScripts&&null!==e.zip.workerScriptsPath)return void n(new Error("Either zip.workerScripts or zip.workerScriptsPath may be set, not both."));var o;if(e.zip.workerScripts){if(o=e.zip.workerScripts[t],!Array.isArray(o))return void n(new Error("zip.workerScripts."+t+" is not an array!"));o=U(o)}else o=H[t].slice(0),o[0]=(e.zip.workerScriptsPath||"")+o[0];var s=new Worker(o[0]);s.codecTime=s.crcTime=0,s.postMessage({type:"importScripts",scripts:o.slice(1)}),s.addEventListener("message",r),s.addEventListener("error",a)}function I(e){console.error(e)}var D,P="File format is not recognized.",F="CRC failed.",T="File contains encrypted entry.",z="File is using Zip64 (4gb+ file size).",M="Error while reading zip file.",O="Error while writing zip file.",C="Error while writing file data.",L="Error while reading file data.",B="File already exists.",j=524288,N="text/plain";try{D=0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch(W){}t.prototype.append=function(e){for(var t=0|this.crc,i=this.table,n=0,r=0|e.length;r>n;n++)t=t>>>8^i[255&(t^e[n])];this.crc=t},t.prototype.get=function(){return~this.crc},t.prototype.table=function(){var e,t,i,n=[];for(e=0;256>e;e++){for(i=e,t=0;8>t;t++)1&i?i=i>>>1^3988292384:i>>>=1;n[e]=i}return n}(),i.prototype.append=function(e){return e},i.prototype.flush=function(){},o.prototype=new a,o.prototype.constructor=o,s.prototype=new a,s.prototype.constructor=s,l.prototype=new a,l.prototype.constructor=l,c.prototype.getData=function(e){e(this.data)},f.prototype=new c,f.prototype.constructor=f,u.prototype=new c,u.prototype.constructor=u,d.prototype=new c,d.prototype.constructor=d;var H={deflater:["z-worker.js","deflate.js"],inflater:["z-worker.js","inflate.js"]};e.zip={Reader:a,Writer:c,BlobReader:l,Data64URIReader:s,TextReader:o,BlobWriter:d,Data64URIWriter:u,TextWriter:f,createReader:function(e,t,i){i=i||I,e.init(function(){k(e,t,i)},i)},createWriter:function(e,t,i,n){i=i||I,n=!!n,e.init(function(){R(e,t,i,n)},i)},useWebWorkers:!0,workerScriptsPath:null,workerScripts:null}}(this),define("zip",function(e){return function(){var t;return t||e.zip}}(this)),function(e){"use strict";function t(){function e(e,t,i,n,c,f,u,_,p,b,w){var g,y,m,x,k,E,S,R,A,I,D,P,F,T,z;I=0,k=i;do r[e[t+I]]++,I++,k--;while(0!==k);if(r[0]==i)return u[0]=-1,_[0]=0,l;for(R=_[0],E=1;U>=E&&0===r[E];E++);for(S=E,E>R&&(R=E),k=U;0!==k&&0===r[k];k--);for(m=k,R>k&&(R=k),_[0]=R,T=1<<E;k>E;E++,T<<=1)if((T-=r[E])<0)return d;if((T-=r[k])<0)return d;for(r[k]+=T,s[1]=E=0,I=1,F=2;0!==--k;)s[F]=E+=r[I],F++,I++;k=0,I=0;do 0!==(E=e[t+I])&&(w[s[E]++]=k),I++;while(++k<i);for(i=s[m],s[0]=k=0,I=0,x=-1,P=-R,o[0]=0,D=0,z=0;m>=S;S++)for(g=r[S];0!==g--;){for(;S>P+R;){if(x++,P+=R,z=m-P,z=z>R?R:z,(y=1<<(E=S-P))>g+1&&(y-=g+1,F=S,z>E))for(;++E<z&&!((y<<=1)<=r[++F]);)y-=r[F];if(z=1<<E,b[0]+z>v)return d;o[x]=D=b[0],b[0]+=z,0!==x?(s[x]=k,a[0]=E,a[1]=R,E=k>>>P-R,a[2]=D-o[x-1]-E,p.set(a,3*(o[x-1]+E))):u[0]=D}for(a[1]=S-P,I>=i?a[0]=192:w[I]<n?(a[0]=w[I]<256?0:96,a[2]=w[I++]):(a[0]=f[w[I]-n]+16+64,a[2]=c[w[I++]-n]),y=1<<S-P,E=k>>>P;z>E;E+=y)p.set(a,3*(D+E));for(E=1<<S-1;0!==(k&E);E>>>=1)k^=E;for(k^=E,A=(1<<P)-1;(k&A)!=s[x];)x--,P-=R,A=(1<<P)-1}return 0!==T&&1!=m?h:l}function t(e){var t;for(i||(i=[],n=[],r=new Int32Array(U+1),a=[],o=new Int32Array(U),s=new Int32Array(U+1)),n.length<e&&(n=[]),t=0;e>t;t++)n[t]=0;for(t=0;U+1>t;t++)r[t]=0;for(t=0;3>t;t++)a[t]=0;o.set(r.subarray(0,U),0),s.set(r.subarray(0,U+1),0)}var i,n,r,a,o,s,c=this;c.inflate_trees_bits=function(r,a,o,s,l){var c;return t(19),i[0]=0,c=e(r,0,19,19,null,null,o,a,s,i,n),c==d?l.msg="oversubscribed dynamic bit lengths tree":(c==h||0===a[0])&&(l.msg="incomplete dynamic bit lengths tree",c=d),c},c.inflate_trees_dynamic=function(r,a,o,s,c,f,u,p,v){var b;return t(288),i[0]=0,b=e(o,0,r,257,k,E,f,s,p,i,n),b!=l||0===s[0]?(b==d?v.msg="oversubscribed literal/length tree":b!=_&&(v.msg="incomplete literal/length tree",b=d),b):(t(288),b=e(o,r,a,0,S,R,u,c,p,i,n),b!=l||0===c[0]&&r>257?(b==d?v.msg="oversubscribed distance tree":b==h?(v.msg="incomplete distance tree",b=d):b!=_&&(v.msg="empty distance tree with lengths",b=d),b):l)}}function i(){function e(e,t,i,n,r,a,o,s){var f,u,_,h,v,b,w,g,y,m,x,k,E,S,R,U;w=s.next_in_index,g=s.avail_in,v=o.bitb,b=o.bitk,y=o.write,m=y<o.read?o.read-y-1:o.end-y,x=p[e],k=p[t];do{for(;20>b;)g--,v|=(255&s.read_byte(w++))<<b,b+=8;if(f=v&x,u=i,_=n,U=3*(_+f),0!==(h=u[U]))for(;;){if(v>>=u[U+1],b-=u[U+1],0!==(16&h)){for(h&=15,E=u[U+2]+(v&p[h]),v>>=h,b-=h;15>b;)g--,v|=(255&s.read_byte(w++))<<b,b+=8;for(f=v&k,u=r,_=a,U=3*(_+f),h=u[U];;){if(v>>=u[U+1],b-=u[U+1],0!==(16&h)){for(h&=15;h>b;)g--,v|=(255&s.read_byte(w++))<<b,b+=8;if(S=u[U+2]+(v&p[h]),v>>=h,b-=h,m-=E,y>=S)R=y-S,y-R>0&&2>y-R?(o.window[y++]=o.window[R++],o.window[y++]=o.window[R++],E-=2):(o.window.set(o.window.subarray(R,R+2),y),y+=2,R+=2,E-=2);else{R=y-S;do R+=o.end;while(0>R);if(h=o.end-R,E>h){if(E-=h,y-R>0&&h>y-R){do o.window[y++]=o.window[R++];while(0!==--h)}else o.window.set(o.window.subarray(R,R+h),y),y+=h,R+=h,h=0;R=0}}if(y-R>0&&E>y-R){do o.window[y++]=o.window[R++];while(0!==--E)}else o.window.set(o.window.subarray(R,R+E),y),y+=E,R+=E,E=0;break}if(0!==(64&h))return s.msg="invalid distance code",E=s.avail_in-g,E=E>b>>3?b>>3:E,g+=E,w-=E,b-=E<<3,o.bitb=v,o.bitk=b,s.avail_in=g,s.total_in+=w-s.next_in_index,s.next_in_index=w,o.write=y,d;f+=u[U+2],f+=v&p[h],U=3*(_+f),h=u[U]}break}if(0!==(64&h))return 0!==(32&h)?(E=s.avail_in-g,E=E>b>>3?b>>3:E,g+=E,w-=E,b-=E<<3,o.bitb=v,o.bitk=b,s.avail_in=g,s.total_in+=w-s.next_in_index,s.next_in_index=w,o.write=y,c):(s.msg="invalid literal/length code",E=s.avail_in-g,E=E>b>>3?b>>3:E,g+=E,w-=E,b-=E<<3,o.bitb=v,o.bitk=b,s.avail_in=g,s.total_in+=w-s.next_in_index,s.next_in_index=w,o.write=y,d);if(f+=u[U+2],f+=v&p[h],U=3*(_+f),0===(h=u[U])){v>>=u[U+1],b-=u[U+1],o.window[y++]=u[U+2],m--;break}}else v>>=u[U+1],b-=u[U+1],o.window[y++]=u[U+2],m--}while(m>=258&&g>=10);return E=s.avail_in-g,E=E>b>>3?b>>3:E,g+=E,w-=E,b-=E<<3,o.bitb=v,o.bitk=b,s.avail_in=g,s.total_in+=w-s.next_in_index,s.next_in_index=w,o.write=y,l}var t,i,n,r,a=this,o=0,s=0,f=0,_=0,h=0,v=0,b=0,w=0,g=0,y=0;a.init=function(e,a,o,s,l,c){t=A,b=e,w=a,n=o,g=s,r=l,y=c,i=null},a.proc=function(a,m,x){var k,E,S,R,U,L,B,j=0,N=0,W=0;for(W=m.next_in_index,R=m.avail_in,j=a.bitb,N=a.bitk,U=a.write,L=U<a.read?a.read-U-1:a.end-U;;)switch(t){case A:if(L>=258&&R>=10&&(a.bitb=j,a.bitk=N,m.avail_in=R,m.total_in+=W-m.next_in_index,m.next_in_index=W,a.write=U,x=e(b,w,n,g,r,y,a,m),W=m.next_in_index,R=m.avail_in,j=a.bitb,N=a.bitk,U=a.write,L=U<a.read?a.read-U-1:a.end-U,x!=l)){t=x==c?M:C;break}f=b,i=n,s=g,t=I;case I:for(k=f;k>N;){if(0===R)return a.bitb=j,a.bitk=N,m.avail_in=R,m.total_in+=W-m.next_in_index,m.next_in_index=W,a.write=U,a.inflate_flush(m,x);x=l,R--,j|=(255&m.read_byte(W++))<<N,N+=8}if(E=3*(s+(j&p[k])),j>>>=i[E+1],N-=i[E+1],S=i[E],0===S){_=i[E+2],t=z;break}if(0!==(16&S)){h=15&S,o=i[E+2],t=D;break}if(0===(64&S)){f=S,s=E/3+i[E+2];break}if(0!==(32&S)){t=M;break}return t=C,m.msg="invalid literal/length code",x=d,a.bitb=j,a.bitk=N,m.avail_in=R,m.total_in+=W-m.next_in_index,m.next_in_index=W,a.write=U,a.inflate_flush(m,x);case D:for(k=h;k>N;){if(0===R)return a.bitb=j,a.bitk=N,m.avail_in=R,m.total_in+=W-m.next_in_index,m.next_in_index=W,a.write=U,a.inflate_flush(m,x);x=l,R--,j|=(255&m.read_byte(W++))<<N,N+=8}o+=j&p[k],j>>=k,N-=k,f=w,i=r,s=y,t=P;case P:for(k=f;k>N;){if(0===R)return a.bitb=j,a.bitk=N,m.avail_in=R,m.total_in+=W-m.next_in_index,m.next_in_index=W,a.write=U,a.inflate_flush(m,x);x=l,R--,j|=(255&m.read_byte(W++))<<N,N+=8}if(E=3*(s+(j&p[k])),j>>=i[E+1],N-=i[E+1],S=i[E],0!==(16&S)){h=15&S,v=i[E+2],t=F;break}if(0===(64&S)){f=S,s=E/3+i[E+2];break}return t=C,m.msg="invalid distance code",x=d,a.bitb=j,a.bitk=N,m.avail_in=R,m.total_in+=W-m.next_in_index,m.next_in_index=W,a.write=U,a.inflate_flush(m,x);case F:for(k=h;k>N;){if(0===R)return a.bitb=j,a.bitk=N,m.avail_in=R,m.total_in+=W-m.next_in_index,m.next_in_index=W,a.write=U,a.inflate_flush(m,x);x=l,R--,j|=(255&m.read_byte(W++))<<N,N+=8}v+=j&p[k],j>>=k,N-=k,t=T;case T:for(B=U-v;0>B;)B+=a.end;for(;0!==o;){if(0===L&&(U==a.end&&0!==a.read&&(U=0,L=U<a.read?a.read-U-1:a.end-U),0===L&&(a.write=U,x=a.inflate_flush(m,x),U=a.write,L=U<a.read?a.read-U-1:a.end-U,U==a.end&&0!==a.read&&(U=0,L=U<a.read?a.read-U-1:a.end-U),0===L)))return a.bitb=j,a.bitk=N,m.avail_in=R,m.total_in+=W-m.next_in_index,m.next_in_index=W,a.write=U,a.inflate_flush(m,x);a.window[U++]=a.window[B++],L--,B==a.end&&(B=0),o--}t=A;break;case z:if(0===L&&(U==a.end&&0!==a.read&&(U=0,L=U<a.read?a.read-U-1:a.end-U),0===L&&(a.write=U,x=a.inflate_flush(m,x),U=a.write,L=U<a.read?a.read-U-1:a.end-U,U==a.end&&0!==a.read&&(U=0,L=U<a.read?a.read-U-1:a.end-U),0===L)))return a.bitb=j,a.bitk=N,m.avail_in=R,m.total_in+=W-m.next_in_index,m.next_in_index=W,a.write=U,a.inflate_flush(m,x);x=l,a.window[U++]=_,L--,t=A;break;case M:if(N>7&&(N-=8,R++,W--),a.write=U,x=a.inflate_flush(m,x),U=a.write,L=U<a.read?a.read-U-1:a.end-U,a.read!=a.write)return a.bitb=j,a.bitk=N,m.avail_in=R,m.total_in+=W-m.next_in_index,m.next_in_index=W,a.write=U,a.inflate_flush(m,x);t=O;case O:return x=c,a.bitb=j,a.bitk=N,m.avail_in=R,m.total_in+=W-m.next_in_index,m.next_in_index=W,a.write=U,a.inflate_flush(m,x);case C:return x=d,a.bitb=j,a.bitk=N,m.avail_in=R,m.total_in+=W-m.next_in_index,m.next_in_index=W,a.write=U,a.inflate_flush(m,x);default:return x=u,a.bitb=j,a.bitk=N,m.avail_in=R,m.total_in+=W-m.next_in_index,m.next_in_index=W,a.write=U,a.inflate_flush(m,x)}},a.free=function(){}}function n(e,n){var r,a=this,o=B,s=0,f=0,_=0,b=[0],w=[0],g=new i,y=0,m=new Int32Array(3*v),x=0,k=new t;a.bitk=0,a.bitb=0,a.window=new Uint8Array(n),a.end=n,a.read=0,a.write=0,a.reset=function(e,t){t&&(t[0]=x),o==Z&&g.free(e),o=B,a.bitk=0,a.bitb=0,a.read=a.write=0},a.reset(e,null),a.inflate_flush=function(e,t){var i,n,r;return n=e.next_out_index,r=a.read,i=(r<=a.write?a.write:a.end)-r,i>e.avail_out&&(i=e.avail_out),0!==i&&t==h&&(t=l),e.avail_out-=i,e.total_out+=i,e.next_out.set(a.window.subarray(r,r+i),n),n+=i,r+=i,r==a.end&&(r=0,a.write==a.end&&(a.write=0),i=a.write-r,i>e.avail_out&&(i=e.avail_out),0!==i&&t==h&&(t=l),e.avail_out-=i,e.total_out+=i,e.next_out.set(a.window.subarray(r,r+i),n),n+=i,r+=i),e.next_out_index=n,a.read=r,t},a.proc=function(e,i){var n,h,v,x,E,S,R,U;for(x=e.next_in_index,E=e.avail_in,h=a.bitb,v=a.bitk,S=a.write,R=S<a.read?a.read-S-1:a.end-S;;)switch(o){case B:for(;3>v;){if(0===E)return a.bitb=h,a.bitk=v,e.avail_in=E,e.total_in+=x-e.next_in_index,e.next_in_index=x,a.write=S,a.inflate_flush(e,i);i=l,E--,h|=(255&e.read_byte(x++))<<v,v+=8}switch(n=7&h,y=1&n,n>>>1){case 0:h>>>=3,v-=3,n=7&v,h>>>=n,v-=n,o=j;break;case 1:var A=[],I=[],D=[[]],P=[[]];t.inflate_trees_fixed(A,I,D,P),g.init(A[0],I[0],D[0],0,P[0],0),h>>>=3,v-=3,o=Z;break;case 2:h>>>=3,v-=3,o=W;break;case 3:return h>>>=3,v-=3,o=K,e.msg="invalid block type",i=d,a.bitb=h,a.bitk=v,e.avail_in=E,e.total_in+=x-e.next_in_index,e.next_in_index=x,a.write=S,a.inflate_flush(e,i)}break;case j:for(;32>v;){if(0===E)return a.bitb=h,a.bitk=v,e.avail_in=E,e.total_in+=x-e.next_in_index,e.next_in_index=x,a.write=S,a.inflate_flush(e,i);i=l,E--,h|=(255&e.read_byte(x++))<<v,v+=8}if((~h>>>16&65535)!=(65535&h))return o=K,e.msg="invalid stored block lengths",i=d,a.bitb=h,a.bitk=v,e.avail_in=E,e.total_in+=x-e.next_in_index,e.next_in_index=x,a.write=S,a.inflate_flush(e,i);s=65535&h,h=v=0,o=0!==s?N:0!==y?J:B;break;case N:if(0===E)return a.bitb=h,a.bitk=v,e.avail_in=E,e.total_in+=x-e.next_in_index,e.next_in_index=x,a.write=S,a.inflate_flush(e,i);if(0===R&&(S==a.end&&0!==a.read&&(S=0,R=S<a.read?a.read-S-1:a.end-S),0===R&&(a.write=S,i=a.inflate_flush(e,i),S=a.write,R=S<a.read?a.read-S-1:a.end-S,S==a.end&&0!==a.read&&(S=0,R=S<a.read?a.read-S-1:a.end-S),0===R)))return a.bitb=h,a.bitk=v,e.avail_in=E,e.total_in+=x-e.next_in_index,e.next_in_index=x,a.write=S,a.inflate_flush(e,i);if(i=l,n=s,n>E&&(n=E),n>R&&(n=R),a.window.set(e.read_buf(x,n),S),x+=n,E-=n,S+=n,R-=n,0!==(s-=n))break;o=0!==y?J:B;break;case W:for(;14>v;){if(0===E)return a.bitb=h,a.bitk=v,e.avail_in=E,e.total_in+=x-e.next_in_index,e.next_in_index=x,a.write=S,a.inflate_flush(e,i);i=l,E--,h|=(255&e.read_byte(x++))<<v,v+=8}if(f=n=16383&h,(31&n)>29||(n>>5&31)>29)return o=K,e.msg="too many length or distance symbols",i=d,a.bitb=h,a.bitk=v,e.avail_in=E,e.total_in+=x-e.next_in_index,e.next_in_index=x,a.write=S,a.inflate_flush(e,i);if(n=258+(31&n)+(n>>5&31),!r||r.length<n)r=[];else for(U=0;n>U;U++)r[U]=0;h>>>=14,v-=14,_=0,o=H;case H:for(;4+(f>>>10)>_;){for(;3>v;){if(0===E)return a.bitb=h,a.bitk=v,e.avail_in=E,e.total_in+=x-e.next_in_index,e.next_in_index=x,a.write=S,a.inflate_flush(e,i);i=l,E--,h|=(255&e.read_byte(x++))<<v,v+=8}r[L[_++]]=7&h,h>>>=3,v-=3}for(;19>_;)r[L[_++]]=0;if(b[0]=7,n=k.inflate_trees_bits(r,b,w,m,e),n!=l)return i=n,i==d&&(r=null,o=K),a.bitb=h,a.bitk=v,e.avail_in=E,e.total_in+=x-e.next_in_index,e.next_in_index=x,a.write=S,a.inflate_flush(e,i);_=0,o=G;case G:for(;;){if(n=f,_>=258+(31&n)+(n>>5&31))break;var F,T;for(n=b[0];n>v;){if(0===E)return a.bitb=h,a.bitk=v,e.avail_in=E,e.total_in+=x-e.next_in_index,e.next_in_index=x,a.write=S,a.inflate_flush(e,i);i=l,E--,h|=(255&e.read_byte(x++))<<v,v+=8}if(n=m[3*(w[0]+(h&p[n]))+1],T=m[3*(w[0]+(h&p[n]))+2],16>T)h>>>=n,v-=n,r[_++]=T;else{for(U=18==T?7:T-14,F=18==T?11:3;n+U>v;){if(0===E)return a.bitb=h,a.bitk=v,e.avail_in=E,e.total_in+=x-e.next_in_index,e.next_in_index=x,a.write=S,a.inflate_flush(e,i);i=l,E--,h|=(255&e.read_byte(x++))<<v,v+=8}if(h>>>=n,v-=n,F+=h&p[U],h>>>=U,v-=U,U=_,n=f,U+F>258+(31&n)+(n>>5&31)||16==T&&1>U)return r=null,o=K,e.msg="invalid bit length repeat",i=d,a.bitb=h,a.bitk=v,e.avail_in=E,e.total_in+=x-e.next_in_index,e.next_in_index=x,a.write=S,a.inflate_flush(e,i);
T=16==T?r[U-1]:0;do r[U++]=T;while(0!==--F);_=U}}w[0]=-1;var z=[],M=[],O=[],C=[];if(z[0]=9,M[0]=6,n=f,n=k.inflate_trees_dynamic(257+(31&n),1+(n>>5&31),r,z,M,O,C,m,e),n!=l)return n==d&&(r=null,o=K),i=n,a.bitb=h,a.bitk=v,e.avail_in=E,e.total_in+=x-e.next_in_index,e.next_in_index=x,a.write=S,a.inflate_flush(e,i);g.init(z[0],M[0],m,O[0],m,C[0]),o=Z;case Z:if(a.bitb=h,a.bitk=v,e.avail_in=E,e.total_in+=x-e.next_in_index,e.next_in_index=x,a.write=S,(i=g.proc(a,e,i))!=c)return a.inflate_flush(e,i);if(i=l,g.free(e),x=e.next_in_index,E=e.avail_in,h=a.bitb,v=a.bitk,S=a.write,R=S<a.read?a.read-S-1:a.end-S,0===y){o=B;break}o=J;case J:if(a.write=S,i=a.inflate_flush(e,i),S=a.write,R=S<a.read?a.read-S-1:a.end-S,a.read!=a.write)return a.bitb=h,a.bitk=v,e.avail_in=E,e.total_in+=x-e.next_in_index,e.next_in_index=x,a.write=S,a.inflate_flush(e,i);o=q;case q:return i=c,a.bitb=h,a.bitk=v,e.avail_in=E,e.total_in+=x-e.next_in_index,e.next_in_index=x,a.write=S,a.inflate_flush(e,i);case K:return i=d,a.bitb=h,a.bitk=v,e.avail_in=E,e.total_in+=x-e.next_in_index,e.next_in_index=x,a.write=S,a.inflate_flush(e,i);default:return i=u,a.bitb=h,a.bitk=v,e.avail_in=E,e.total_in+=x-e.next_in_index,e.next_in_index=x,a.write=S,a.inflate_flush(e,i)}},a.free=function(e){a.reset(e,null),a.window=null,m=null},a.set_dictionary=function(e,t,i){a.window.set(e.subarray(t,t+i),0),a.read=a.write=i},a.sync_point=function(){return o==j?1:0}}function r(){function e(e){return e&&e.istate?(e.total_in=e.total_out=0,e.msg=null,e.istate.mode=rt,e.istate.blocks.reset(e,null),l):u}var t=this;t.mode=0,t.method=0,t.was=[0],t.need=0,t.marker=0,t.wbits=0,t.inflateEnd=function(e){return t.blocks&&t.blocks.free(e),t.blocks=null,l},t.inflateInit=function(i,r){return i.msg=null,t.blocks=null,8>r||r>15?(t.inflateEnd(i),u):(t.wbits=r,i.istate.blocks=new n(i,1<<r),e(i),l)},t.inflate=function(e,t){var i,n;if(!e||!e.istate||!e.next_in)return u;for(t=t==w?h:l,i=h;;)switch(e.istate.mode){case X:if(0===e.avail_in)return i;if(i=t,e.avail_in--,e.total_in++,(15&(e.istate.method=e.read_byte(e.next_in_index++)))!=$){e.istate.mode=ot,e.msg="unknown compression method",e.istate.marker=5;break}if((e.istate.method>>4)+8>e.istate.wbits){e.istate.mode=ot,e.msg="invalid window size",e.istate.marker=5;break}e.istate.mode=Y;case Y:if(0===e.avail_in)return i;if(i=t,e.avail_in--,e.total_in++,n=255&e.read_byte(e.next_in_index++),((e.istate.method<<8)+n)%31!==0){e.istate.mode=ot,e.msg="incorrect header check",e.istate.marker=5;break}if(0===(n&V)){e.istate.mode=rt;break}e.istate.mode=Q;case Q:if(0===e.avail_in)return i;i=t,e.avail_in--,e.total_in++,e.istate.need=(255&e.read_byte(e.next_in_index++))<<24&4278190080,e.istate.mode=et;case et:if(0===e.avail_in)return i;i=t,e.avail_in--,e.total_in++,e.istate.need+=(255&e.read_byte(e.next_in_index++))<<16&16711680,e.istate.mode=tt;case tt:if(0===e.avail_in)return i;i=t,e.avail_in--,e.total_in++,e.istate.need+=(255&e.read_byte(e.next_in_index++))<<8&65280,e.istate.mode=it;case it:return 0===e.avail_in?i:(i=t,e.avail_in--,e.total_in++,e.istate.need+=255&e.read_byte(e.next_in_index++),e.istate.mode=nt,f);case nt:return e.istate.mode=ot,e.msg="need dictionary",e.istate.marker=0,u;case rt:if(i=e.istate.blocks.proc(e,i),i==d){e.istate.mode=ot,e.istate.marker=0;break}if(i==l&&(i=t),i!=c)return i;i=t,e.istate.blocks.reset(e,e.istate.was),e.istate.mode=at;case at:return c;case ot:return d;default:return u}},t.inflateSetDictionary=function(e,t,i){var n=0,r=i;return e&&e.istate&&e.istate.mode==nt?(r>=1<<e.istate.wbits&&(r=(1<<e.istate.wbits)-1,n=i-r),e.istate.blocks.set_dictionary(t,n,r),e.istate.mode=rt,l):u},t.inflateSync=function(t){var i,n,r,a,o;if(!t||!t.istate)return u;if(t.istate.mode!=ot&&(t.istate.mode=ot,t.istate.marker=0),0===(i=t.avail_in))return h;for(n=t.next_in_index,r=t.istate.marker;0!==i&&4>r;)t.read_byte(n)==st[r]?r++:r=0!==t.read_byte(n)?0:4-r,n++,i--;return t.total_in+=n-t.next_in_index,t.next_in_index=n,t.avail_in=i,t.istate.marker=r,4!=r?d:(a=t.total_in,o=t.total_out,e(t),t.total_in=a,t.total_out=o,t.istate.mode=rt,l)},t.inflateSyncPoint=function(e){return e&&e.istate&&e.istate.blocks?e.istate.blocks.sync_point():u}}function a(){}function o(){var e=this,t=new a,i=512,n=b,r=new Uint8Array(i),o=!1;t.inflateInit(),t.next_out=r,e.append=function(e,a){var s,f,u=[],d=0,_=0,p=0;if(0!==e.length){t.next_in_index=0,t.next_in=e,t.avail_in=e.length;do{if(t.next_out_index=0,t.avail_out=i,0!==t.avail_in||o||(t.next_in_index=0,o=!0),s=t.inflate(n),o&&s===h){if(0!==t.avail_in)throw new Error("inflating: bad input")}else if(s!==l&&s!==c)throw new Error("inflating: "+t.msg);if((o||s===c)&&t.avail_in===e.length)throw new Error("inflating: bad input");t.next_out_index&&u.push(t.next_out_index===i?new Uint8Array(r):new Uint8Array(r.subarray(0,t.next_out_index))),p+=t.next_out_index,a&&t.next_in_index>0&&t.next_in_index!=d&&(a(t.next_in_index),d=t.next_in_index)}while(t.avail_in>0||0===t.avail_out);return f=new Uint8Array(p),u.forEach(function(e){f.set(e,_),_+=e.length}),f}},e.flush=function(){t.inflateEnd()}}var s=15,l=0,c=1,f=2,u=-2,d=-3,_=-4,h=-5,p=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],v=1440,b=0,w=4,g=9,y=5,m=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],x=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],k=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],E=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],S=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],R=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],U=15;t.inflate_trees_fixed=function(e,t,i,n){return e[0]=g,t[0]=y,i[0]=m,n[0]=x,l};var A=0,I=1,D=2,P=3,F=4,T=5,z=6,M=7,O=8,C=9,L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],B=0,j=1,N=2,W=3,H=4,G=5,Z=6,J=7,q=8,K=9,V=32,$=8,X=0,Y=1,Q=2,et=3,tt=4,it=5,nt=6,rt=7,at=12,ot=13,st=[0,0,255,255];a.prototype={inflateInit:function(e){var t=this;return t.istate=new r,e||(e=s),t.istate.inflateInit(t,e)},inflate:function(e){var t=this;return t.istate?t.istate.inflate(t,e):u},inflateEnd:function(){var e=this;if(!e.istate)return u;var t=e.istate.inflateEnd(e);return e.istate=null,t},inflateSync:function(){var e=this;return e.istate?e.istate.inflateSync(e):u},inflateSetDictionary:function(e,t){var i=this;return i.istate?i.istate.inflateSetDictionary(i,e,t):u},read_byte:function(e){var t=this;return t.next_in.subarray(e,e+1)[0]},read_buf:function(e,t){var i=this;return i.next_in.subarray(e,e+t)}};var lt=e.zip||e;lt.Inflater=lt._jzlib_Inflater=o}(this),define("inflate",function(e){return function(){var t;return t||e.zip}}(this)),define("readium_js_viewer/storage/ZipFileLoader",["zip","../workers/Messages","inflate"],function(e){var t=157286400;return e.useWebWorkers=!1,ZipFileLoader=function(e){this.options=e},ZipFileLoader.prototype={init:function(t){if(this.entries)return void t();var i=this.options.buf;this.entries={},self=this,e.createReader(new e.BlobReader(i),function(e){e.getEntries(function(e){for(var i=0;i<e.length;i++)e[i].directory||(self.entries[e[i].filename]=e[i]);t()})},this.options.error)},isZipFile:function(){return!0},getZipBlob:function(){return this.options.buf},loadFile:function(t,i){if(!this.entries)throw"you need to call ZipFileLoader.init first";var n=this.entries[t];n?n.getData(new e.BlobWriter,i):i(null)},loadAllFiles:function(i,n,r){if(!this.entries)throw"you need to call ZipFileLoader.init first";for(var a=this.entries,o=0;o<i.length;o++)delete a[i[o]];var s=[],l=function(){s.length&&setTimeout(c.bind(null,s.shift()),0)},c=function(t){t.getData(new e.BlobWriter,r.bind(null,l,t.filename))},f=this.options.buf,u=0,d=f.size>t?1:200;for(var _ in a){var h=a[_];u++<n||(n+d>=u?(console.log("starting: "+h.filename),c(h)):s.push(h))}return u}},ZipFileLoader}),define("readium_js_viewer/storage/UnpackedDirLoader",[],function(){var e=function(e){this.files=e};return e.prototype={isZipFile:function(){return!1},loadFile:function(e,t){t(this.files[e])},loadAllFiles:function(e,t,i){for(var n=0;n<e.length;n++)delete this.files[e[n]];var r=0;for(var a in this.files)r++<t||setTimeout(i.bind(null,null,a,this.files[a]),0);return r}},e}),define("readium_js_viewer/ModuleConfig",["module"],function(e){var t=e.config();return{imagePathPrefix:t.imagePathPrefix||"",epubLibraryPath:t.epubLibraryPath||"",canHandleUrl:t.canHandleUrl||!1,canHandleDirectory:t.canHandleDirectory||!1,epubReadingSystemUrl:t.epubReadingSystemUrl||"/EPUBREADINGSYSTEM.js",workerUrl:t.workerUrl||"/READIUMWORKER.js",annotationCSSUrl:t.annotationCSSUrl||"/ANNOTATIONS.css",mathJaxUrl:t.mathJaxUrl||"/MATHJAX.js",jsLibRoot:t.jsLibRoot||"/ZIPJS/",useSimpleLoader:t.useSimpleLoader||!1}}),function(e,t){"object"==typeof exports?module.exports=exports=t():"function"==typeof define&&define.amd?define("cryptoJs/core",[],t):e.CryptoJS=t()}(this,function(){var e=e||function(e,t){var i={},n=i.lib={},r=n.Base=function(){function e(){}return{extend:function(t){e.prototype=this;var i=new e;return t&&i.mixIn(t),i.hasOwnProperty("init")||(i.init=function(){i.$super.init.apply(this,arguments)}),i.init.prototype=i,i.$super=this,i},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),a=n.WordArray=r.extend({init:function(e,i){e=this.words=e||[],this.sigBytes=i!=t?i:4*e.length},toString:function(e){return(e||s).stringify(this)},concat:function(e){var t=this.words,i=e.words,n=this.sigBytes,r=e.sigBytes;if(this.clamp(),n%4)for(var a=0;r>a;a++){var o=i[a>>>2]>>>24-a%4*8&255;t[n+a>>>2]|=o<<24-(n+a)%4*8}else for(var a=0;r>a;a+=4)t[n+a>>>2]=i[a>>>2];return this.sigBytes+=r,this},clamp:function(){var t=this.words,i=this.sigBytes;t[i>>>2]&=4294967295<<32-i%4*8,t.length=e.ceil(i/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var i,n=[],r=function(t){var t=t,i=987654321,n=4294967295;return function(){i=36969*(65535&i)+(i>>16)&n,t=18e3*(65535&t)+(t>>16)&n;var r=(i<<16)+t&n;return r/=4294967296,r+=.5,r*(e.random()>.5?1:-1)}},o=0;t>o;o+=4){var s=r(4294967296*(i||e.random()));i=987654071*s(),n.push(4294967296*s()|0)}return new a.init(n,t)}}),o=i.enc={},s=o.Hex={stringify:function(e){for(var t=e.words,i=e.sigBytes,n=[],r=0;i>r;r++){var a=t[r>>>2]>>>24-r%4*8&255;n.push((a>>>4).toString(16)),n.push((15&a).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,i=[],n=0;t>n;n+=2)i[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new a.init(i,t/2)}},l=o.Latin1={stringify:function(e){for(var t=e.words,i=e.sigBytes,n=[],r=0;i>r;r++){var a=t[r>>>2]>>>24-r%4*8&255;n.push(String.fromCharCode(a))}return n.join("")},parse:function(e){for(var t=e.length,i=[],n=0;t>n;n++)i[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(i,t)}},c=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}},f=n.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var i=this._data,n=i.words,r=i.sigBytes,o=this.blockSize,s=4*o,l=r/s;l=t?e.ceil(l):e.max((0|l)-this._minBufferSize,0);var c=l*o,f=e.min(4*c,r);if(c){for(var u=0;c>u;u+=o)this._doProcessBlock(n,u);var d=n.splice(0,c);i.sigBytes-=f}return new a.init(d,f)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),u=(n.Hasher=f.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,i){return new e.init(i).finalize(t)}},_createHmacHelper:function(e){return function(t,i){return new u.HMAC.init(e,i).finalize(t)}}}),i.algo={});return i}(Math);return e}),define("cryptoJs",["cryptoJs/core"],function(e){return e}),function(e,t){"object"==typeof exports?module.exports=exports=t(require("./core")):"function"==typeof define&&define.amd?define("cryptoJs/sha1",["./core"],t):t(e.CryptoJS)}(this,function(e){return function(){var t=e,i=t.lib,n=i.WordArray,r=i.Hasher,a=t.algo,o=[],s=a.SHA1=r.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var i=this._hash.words,n=i[0],r=i[1],a=i[2],s=i[3],l=i[4],c=0;80>c;c++){if(16>c)o[c]=0|e[t+c];else{var f=o[c-3]^o[c-8]^o[c-14]^o[c-16];o[c]=f<<1|f>>>31}var u=(n<<5|n>>>27)+l+o[c];u+=20>c?(r&a|~r&s)+1518500249:40>c?(r^a^s)+1859775393:60>c?(r&a|r&s|a&s)-1894007588:(r^a^s)-899497514,l=s,s=a,a=r<<30|r>>>2,r=n,n=u}i[0]=i[0]+n|0,i[1]=i[1]+r|0,i[2]=i[2]+a|0,i[3]=i[3]+s|0,i[4]=i[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[(n+64>>>9<<4)+14]=Math.floor(i/4294967296),t[(n+64>>>9<<4)+15]=i,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA1=r._createHelper(s),t.HmacSHA1=r._createHmacHelper(s)}(),e.SHA1}),define("readium_js/epub-fetch/encryption_handler",["cryptoJs/sha1"],function(e){var t=function(e){function t(e,t){var i=new FileReader;i.onload=function(){var e=this.result;t(new Uint8Array(e))},i.readAsArrayBuffer(e)}function i(e,i,n,r){var a=e.slice(0,i);t(a,function(t){for(var a=n.length,o=0;i>o;o++)t[o]=t[o]^n[o%a];var s=new Blob([t],{type:e.type}),l=e.slice(i),c=new Blob([s,l],{type:e.type});r(c)})}function n(t,n){var r=1040;i(t,r,e.uidHash,n)}function r(e){var t=/(urn:uuid:)?([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})/i,i=t.exec(e),n=i[2]+i[3]+i[4]+i[5]+i[6];n&&32==n.length||console.error("Bad UUID format for ID :"+e);for(var r=[],a=0;16>a;a++){var o=n.substr(2*a,2),s=parseInt(o,16);r.push(s)}return r}function a(t,n){var a=r(e.uid),o=1024;i(t,o,a,n)}var o=this,s={"http://www.idpf.org/2008/embedding":n,"http://ns.adobe.com/pdf/enc#RC":a};this.isEncryptionSpecified=function(){return e&&e.encryptions},this.getEncryptionMethodForRelativePath=function(t){return o.isEncryptionSpecified()?e.encryptions[t]:void 0},this.getDecryptionFunctionForRelativePath=function(e){var t=o.getEncryptionMethodForRelativePath(e);return t&&s[t]?s[t]:void 0}};return t.CreateEncryptionData=function(t,i){var n={uid:t,uidHash:e(unescape(encodeURIComponent(t.trim())),{asBytes:!0}),encryptions:void 0},r=$("EncryptedData",i);return r.each(function(e,t){var i=$("EncryptionMethod",t).first().attr("Algorithm"),r=$("CipherReference",t);r.each(function(e,t){var r=$(t).attr("URI");console.log("Encryption/obfuscation algorithm "+i+" specified for "+r),n.encryptions||(n.encryptions={}),n.encryptions[r]=i})}),n},t}),define("readium_js_viewer/workers/ContentTransformer",["../ModuleConfig","readium_js/epub-fetch/encryption_handler"],function(e,t){var i=function(e){return e.lastIndexOf(".xhtml")==e.length-".xhtml".length||e.lastIndexOf(".html")==e.length-".html".length},n=function(e){this.encryptionHandler=new t(e)};return n.prototype={transformContent:function(e,t,n){var r=this.encryptionHandler.getDecryptionFunctionForRelativePath(e);if(r)try{r(t,n)}catch(a){console.error(a),n(t)}else if(i(e)){var o=new FileReader,s=this;o.onload=function(){var e=s._transformXhtml(this.result);n(new Blob([e]))},o.readAsText(t)}else n(t)},_transformXhtml:function(t){var i=e.mathJaxUrl,n=e.epubReadingSystemUrl,r="";n&&(r+='<script type="text/javascript" src="'+n+'"></script>'),i&&t.indexOf("<math")>=0&&(r+='<script type="text/javascript" src="'+i+'"></script>');var a=r?t.replace(/(<head.*?>)/,"$1"+r):t;return a}},n}),define("readium_js_viewer/workers/EpubLibraryWriter",["StorageManager","../storage/ZipFileLoader","../storage/UnpackedDirLoader","./Messages","./ContentTransformer"],function(e,t,i,n,r){var a=function(){};a.prototype={_getFullUrl:function(e,t){if(!t)return null;var i=e.split("/");i.pop();var n=i.join("/");return n+("/"==t.charAt(0)?"":"/")+t},_saveLibraryIndex:function(t,i){var n=new Blob([JSON.stringify(this.libraryData)]);e.saveFile("/epub_library.json",n,t,i)},_saveEpubToIndex:function(e,t){this.libraryData.push(t),this._saveLibraryIndex(function(){e.success(t)},e.error)},_addEpub:function(t,i,a,o){var s=this.rootDirName||(new Date).getTime()+""+Math.floor(1e3*Math.random()),l=this,c=this.fileLoader,f=function(e,i){return 7==i.original.code&&l.callbacks.continueImport&&c.isZipFile()?void l.callbacks.continueImport(c.getZipBlob(),h,s):void t.error(e,i)},u=function(){var n={id:i.id,rootDir:s,packagePath:a,title:i.title,author:i.author,rootUrl:e.getPathUrl(s)};i.coverHref&&(n.coverPath=i.coverHref,n.coverHref=e.getPathUrl(s+"/"+l._getFullUrl(a,i.coverHref))),l._saveEpubToIndex(t,n)},d=new r(o),_=this.startAtIndex||0,h=_,p=c.loadAllFiles(["META-INF/encryption.xml"],_,function(i,r,a){var o=function(r,a){var o=s+"/"+r;e.saveFile(o,a,function(){t.progress(Math.round(100*(++h/p)),n.PROGRESS_WRITING,h+" of "+p+" ("+r+")"),i&&i(),h==p&&u()},f)};d.transformContent(r,a,o.bind(null,r))})},_replaceEpub:function(e,t,i){var n=this,r=function(t){n.deleteEpub(e,function(){n.callbacks.success(t)},n.callbacks.error)},a={success:r,error:this.callbacks.error,progress:this.callbacks.progress};this._addEpub(a,t,i)},_checkForConflict:function(e,t,i){for(var n=0;n<this.libraryData.length;n++)if(this.libraryData[n].id===e.id){var r=this._replaceEpub.bind(this,this.libraryData[n],e,t),a=this._addEpub.bind(this,this.callbacks,e,t);return void this.callbacks.overwrite(this.libraryData[n],r,a)}this._addEpub(this.callbacks,e,t,i)},_deleteEpubWithIndex:function(t,i,n){var r=this.libraryData[t];this.libraryData.splice(t,1),this._saveLibraryIndex(function(){e.deleteFile(r.rootDir,i,n)},n)},_loadFileAsString:function(e,t,i){var r=(this.callbacks.error,new FileReader);this.fileLoader.loadFile(e,function(a){a?(r.onload=function(){t(this.result)},r.readAsText(a)):i?t(void 0):(this.callbacks.error(n.ERROR_EPUB),console.error("Epub archive or directory missing a required  file: "+e))})},_findPackagePath:function(e,t){l=function(e){l=null,t(e.path)},postMessage({msg:n.FIND_PACKAGE,containerStr:e})},_parsePackageData:function(e,t,i){c=function(e){c=null,i(e.packageObj,e.encryptionData)},postMessage({msg:n.PARSE_PACKAGE,packageStr:e,encryptionStr:t})},_addEpubToLibrary:function(e){this.fileLoader=e;var t=this;this._loadFileAsString("META-INF/container.xml",function(e){t._findPackagePath(e,function(e){t._loadFileAsString(e,function(i){t._loadFileAsString("META-INF/encryption.xml",function(n){t._parsePackageData(i,n,function(i,n){t._checkForConflict(i,e,n)})},!0)})})})},deleteEpubWithId:function(e,t,i){for(var n=0;n<this.libraryData.length&&this.libraryData[n].rootDir!=e;n++);n<this.libraryData.length?this._deleteEpubWithIndex(n,t,i):t()},deleteEpub:function(e,t,i){for(var n=0;n<this.libraryData.length&&this.libraryData[n]!=e;n++);n<this.libraryData.length?this._deleteEpubWithIndex(n,t,i):t()},importZip:function(e,i){this.callbacks=i;var n=new t({buf:e,error:i.error});n.init(this._addEpubToLibrary.bind(this,n))},continueImportZip:function(e,i,n,r){this.callbacks=r,this.startAtIndex=i,this.rootDirName=n;var a=new t({buf:e,error:r.error});this._addEpubToLibrary(a)},importFileList:function(e,t){this.callbacks=t,this._addEpubToLibrary(new i(e))},importUrl:function(e,t){var i=new XMLHttpRequest;self=this,error=function(){t.error(n.ERROR_AJAX)},i.open("GET",e,!0),i.responseType="blob",i.onload=function(){if(200==this.status){var e=new Blob([this.response],{type:"application/epub"});self.importZip(e,t)}else error()},i.onerror=error,i.send()}};var o,s,l,c,f=new a;return onmessage=function(t){var i=t.data,r=i.msg,a=function(){postMessage({msg:n.SUCCESS,library:f.libraryData})},u=function(e,t,i){postMessage({msg:n.PROGRESS,percent:e,progressType:t,progressData:i})},d=function(e,t){postMessage({msg:n.ERROR,errorMsg:e,errorData:t})},_=function(e,t,i){postMessage({msg:n.CONTINUE_IMPORT_ZIP,buf:e,index:t,rootDirName:i,libraryItems:f.libraryData})},h=function(e,t,i){postMessage({msg:n.OVERWRITE,item:e}),o=function(){o=null,s=null,t()},s=function(){o=null,s=null,i()}};switch(r){case n.IMPORT_ZIP:f.libraryData=i.libraryItems;var p=i.buf;e.initStorage(function(){f.importZip(p,{success:a,progress:u,error:d,overwrite:h,continueImport:_})},d);break;case n.CONTINUE_IMPORT_ZIP:f.libraryData=i.libraryItems;var p=i.buf,v=i.index,b=i.rootDirName;e.initStorage(function(){f.continueImportZip(p,v,b,{success:a,progress:u,error:d,overwrite:h,continueImport:_})},d);break;case n.DELETE_EPUB:f.libraryData=i.libraryItems;var w=i.id;e.initStorage(function(){f.deleteEpubWithId(w,a,d)},d);break;case n.IMPORT_DIR:f.libraryData=i.libraryItems;var g=i.files;e.initStorage(function(){f.importFileList(g,{success:a,progress:u,error:d,overwrite:h})},d);break;case n.IMPORT_URL:f.libraryData=i.libraryItems;var y=i.url;e.initStorage(function(){f.importUrl(y,{success:a,progress:u,error:d,overwrite:h})},d);break;case n.MIGRATE:e.initStorage(function(){var t=function(e,t){u(e,n.PROGRESS_MIGRATING,t)};e.migrateLegacyBooks(a,d,t)},d);case n.OVERWRITE_CONTINUE:o&&o(i);break;case n.OVERWRITE_SIDE_BY_SIDE:s&&s(i);break;case n.FIND_PACKAGE_RESPONSE:l&&l(i);break;case n.PARSE_PACKAGE_RESPONSE:c&&c(i)}},{}}),require("readium_js_viewer/workers/EpubLibraryWriter");
//# sourceMappingURL=readium-js-viewer_CHROMEAPP-WORKER.js.map